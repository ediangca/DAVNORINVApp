<div class="row mt-5 d-none d-sm-block" style="height: 10px;"></div>

<div class="container-fluid">
  <div class="table-responsive scrollable" data-aos="zoom-in">
    <div class="table-wrapper">
      <div class="table-title">

        <div class="row d-flex align-items-center">

          <div class="col-12 d-flex just justify-content-center align-items-center">
            <div class="search" style="width: 100%;">
              <i class="fa-sharp-duotone fa-solid fa-magnifying-glass fa-search"></i>
              <input type="text" class="form-control rounded-pill" type="search" [(ngModel)]="searchKey"
                (keyup)="onKeyUp($event)" placeholder="Search here.." aria-label="Search">
              <a class="btn btn-primary d-flex justify-content-center align-items-center rounded-pill" type="button"
                (click)="onSearchOPR()"><i class="fa-sharp-duotone fa-solid fa-magnifying-glass"></i></a>
            </div>
            <a *ngIf="canCreate" class="btn btn-success rounded-pill d-flex justify-content-center align-items-center "
              type="button" (click)="onAddPAR()">
              <i class="fa-sharp-duotone fa-solid fa-plus"></i><span class="fs-6">NEW</span></a>

            <button class="btn btn-dark rounded-pill d-flex justify-content-center align-items-center" type="button"
              (click)="handle(scannerAction, scannerAction.isStart ? 'stop' : 'start', 'retreive')"
              [class.btn-warning]="scannerAction?.isStart" [disabled]="scannerAction?.isLoading || false">
              <i class="fa-solid fa-qrcode"></i>
              <span class="fs-6">Scan</span>
            </button>

          </div>

        </div>

      </div>

      <div *ngIf="isLoading" class="text-center my-3 align-content-center" style="height: 65vh;">
        <img src="assets/images/loading.gif" alt="Loading..." width="100" style="height: 80px;">
        <span class="loading-text text-primary">Loading<span class="dot">.</span>
          <span class="dot">.</span><span class="dot">.</span></span>

        <!-- <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div> -->
      </div>

      <!-- <i class="icon text-info float-end" *ngIf="!isLoading" data-bs-toggle="tooltip" data-bs-html="true"
        data-bs-placement="bottom"
        data-bs-custom-class="custom-tooltip"  [title]="legend">
        <svg class="icon-20" width="20" viewBox="0 0 24 24" fill="none"
          xmlns="http://www.w3.org/2000/svg"> <path opacity="0.4"
            d="M16.34 1.99976H7.67C4.28 1.99976 2 4.37976 2 7.91976V16.0898C2 19.6198 4.28 21.9998 7.67 21.9998H16.34C19.73 21.9998 22 19.6198 22 16.0898V7.91976C22 4.37976 19.73 1.99976 16.34 1.99976Z"
            fill="currentColor"></path> <path fill-rule="evenodd"
            clip-rule="evenodd"
            d="M11.1246 8.18921C11.1246 8.67121 11.5156 9.06421 11.9946 9.06421C12.4876 9.06421 12.8796 8.67121 12.8796 8.18921C12.8796 7.70721 12.4876 7.31421 12.0046 7.31421C11.5196 7.31421 11.1246 7.70721 11.1246 8.18921ZM12.8696 11.362C12.8696 10.88 12.4766 10.487 11.9946 10.487C11.5126 10.487 11.1196 10.88 11.1196 11.362V15.782C11.1196 16.264 11.5126 16.657 11.9946 16.657C12.4766 16.657 12.8696 16.264 12.8696 15.782V11.362Z"
            fill="currentColor"></path> </svg>
      </i> -->

      <table class="table table-striped table-hover" *ngIf="!isLoading">
        <thead>
          <tr>
            <th></th>
            <th>Date Created</th>
            <th>OPR #</th>
            <th>Source</th>
            <th>Owner</th>
            <th>Issued By</th>
            <th>Recieved By</th>
            <th>Created By</th>
            <th class="text-center">Actions

            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of oprs">
            <td>
              <a [ngClass]="p.postFlag ? 'primary' : 'secondary'" type="button" (click)="onPost(p)">
                <i class="fa-sharp-duotone fa-solid fa-thumbtack" data-toggle="tooltip"
                  [title]="p.postFlag ? 'Posted' : 'Not yet Posted'"></i>
              </a>
            </td>
            <td>{{formatDate(p.date_Created)}}</td>
            <td>{{'OPR-000'+p.oprNo}}</td>
            <td>{{p.itemSource}}</td>
            <td>{{p.ownership}}</td>
            <td>{{p.issued}}</td>
            <td [ngClass]="p.isReceivedActive? 'text-danger' : ''">
              {{p.received}}
            </td>
            <td>{{p.created}}</td>
            <td>
              <form class="d-flex justify-content-end align-items-center">
                @if(p.userName == "admin"){
                <span><i class="fa-sharp-duotone fa-solid fa-asterisk" data-toggle="tooltip"
                    title="System Default"></i></span>
                }@else{
                <a *ngIf="canRetrieve" class="edit" type="button" (click)="onEditOPR(p)"><i
                    class="fa-sharp-duotone fa-solid fa-pen-to-square" data-toggle="tooltip" title="Edit"></i></a>
                <a *ngIf="canDelete  && p.createdBy === userAccount.userID" class="delete" type="button"
                  (click)="onDelete(p)"><i class="fa-sharp-duotone fa-solid fa-trash" data-toggle="tooltip"
                    title="Delete"></i></a>
                <a *ngIf="canRetrieve" class="success" type="button" (click)="onViewOPR(p)">
                  <i class="fa-sharp-duotone fa-solid fa-eye" data-toggle="tooltip" title="View"></i>
                </a>
                <a class="seconadry" type="button" (click)="onPrint(p.oprNo!)">
                  <i class="fa-sharp-duotone fa-solid fa-print" data-toggle="tooltip" title="Print"></i>
                </a>
                <a *ngIf="canOPTR  && (p.receivedBy=== userAccount.userID || p.createdBy== userAccount.userID ||
                  userAccount.userGroupName === 'System Administrator'
                )" class="primary" type="button" (click)="onTransfer(p)"><i class="fa-solid fa-share-from-square"
                    data-toggle="tooltip" title="Transfer"></i></a>
                }
              </form>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="clearfix" *ngIf="!isLoading">
        <div class="hint-text">Showing <b>{{oprs.length}}</b> out of
          <b>{{totalItems}}</b>entries
        </div>
        <!-- <ul class="pagination">
          <li class="page-item disabled"><a href="#">Previous</a></li>
          <li class="page-item"><a href="#" class="page-link">1</a></li>
          <li class="page-item"><a href="#" class="page-link">2</a></li>
          <li class="page-item active"><a href="#" class="page-link">3</a></li>
          <li class="page-item"><a href="#" class="page-link">4</a></li>
          <li class="page-item"><a href="#" class="page-link">5</a></li>
          <li class="page-item"><a href="#" class="page-link">Next</a></li>
        </ul> -->
      </div>
    </div>
  </div>
</div>

<!-- Modal -->

<!-- ADD/EDIT -->
<div #AddEditModalForm class="modal fade" id="AddEditModalForm">
  <div class="modal-dialog modal-dialog-centered  modal-xl">
    <div class="modal-content formGroup">
      <form class [formGroup]="oprForm" class="ng-untouched ng-pristine ng-invalid">
        <div class="modal-header">
          <div class="d-flex flex-column">
            <h1 class="modal-title fs-5" id="staticBackdropLabel">{{
              isEditMode
              ?
              'Edit OPR #000' + currentEditId: 'Add New OPR'}} </h1>
            <span><em> Other Property Receipt</em></span>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            (click)="closeModal(AddEditModal)"></button>
        </div>

        <div class="modal-body p-0 m-0">

          <div class="card m-0">
            <div class="card-header py-2">
              <div class="row d-flex flex-row">
                <div class="col-12">

                  <!-- Item Source -->

                  @if(!(oprForm.controls['itemsource'].invalid &&
                  oprForm.hasError('required', 'itemsource') &&
                  oprForm.get('itemsource')?.touched ||
                  (oprForm.controls['itemsource'].dirty &&
                  oprForm.hasError('required', 'itemsource')))){
                  <small class="text-info">* Source of Property</small>
                  }@else{
                  <small class="text-danger"
                    *ngIf="oprForm.controls['itemsource'].invalid &&
                    oprForm.hasError('required', 'itemsource') &&
                    oprForm.get('itemsource')?.touched ||
                    (oprForm.controls['itemsource'].dirty &&
                    oprForm.hasError('required', 'itemsource')) ||
                    (isCustomType && ((oprForm.controls['itemsource'].invalid &&
                  oprForm.hasError('required', 'itemsource') &&
                  oprForm.get('itemsource')?.touched) || (oprForm.controls['others'].dirty && oprForm.hasError('required', 'others'))))">*
                    Source of Property is required</small>
                  }

                  <!-- Other Item Source -->

                  <small class="text-danger"
                    *ngIf="isCustomType && oprForm.controls['others'].invalid && oprForm.get('others')?.touched">
                    Specify 'Others' is required.
                  </small>

                  <div class="form-field d-flex align-items-center" [class.error]="oprForm.controls['itemsource'].invalid && oprForm.hasError('required', 'itemsource')  && 
                  oprForm.get('itemsource')?.touched || (oprForm.controls['itemsource'].dirty && oprForm.hasError('required', 'itemsource')) ||
                  (isCustomType && oprForm.controls['others'].invalid && oprForm.hasError('required', 'others')  && oprForm.get('others')?.touched ||
                  (oprForm.controls['others'].dirty && oprForm.hasError('required', 'others'))) ||
                  (isCustomType && oprForm.get('others')?.invalid && oprForm.get('others')?.touched)">

                    <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="(oprForm.controls['others'].invalid && oprForm.hasError('required', 'others')  && 
                    oprForm.get('others')?.touched || (oprForm.controls['others'].dirty && oprForm.hasError('required', 'others'))) ||
                    (isCustomType && oprForm.get('others')?.invalid && oprForm.get('.others')?.touched)">
                    </i>

                    <select formControlName="itemsource" name="itemsource" id="itemsource" class="form-select"
                      (change)="onSourceTypeChange($event)">
                      <option value>Source of Property </option>
                      <option *ngFor="let option of typeOptions" [value]="option">{{option}}</option>
                      <option value="Others">Others</option>
                    </select>

                    <input *ngIf="isCustomType" type="text" id="others" #othersInput value="N/A"
                      formControlName="others" placeholder="Specify" class="form-control">
                  </div>

                </div>
                <div class="col-12">

                  @if(!(oprForm.controls['ownership'].invalid &&
                  oprForm.hasError('required', 'ownership') &&
                  oprForm.get('ownership')?.touched ||
                  (oprForm.controls['ownership'].dirty &&
                  oprForm.hasError('required', 'ownership')))){
                  <small class="text-info">* Owner/Source From</small>
                  }@else {
                  <small class="text-danger" *ngIf="oprForm.controls['ownership'].invalid && oprForm.hasError('required', 'ownership') && oprForm.get('ownership')?.touched ||
                  (oprForm.controls['ownership'].dirty && oprForm.hasError('required', 'ownership'))">* Owner/Source
                    From is required</small>
                  }

                  <div class="form-field d-flex align-items-center"
                    [class.error]="oprForm.controls['ownership'].invalid && oprForm.hasError('required', 'ownership') &&  
                  oprForm.get('ownership')?.touched || (oprForm.controls['ownership'].dirty && oprForm.hasError('required', 'ownership'))">
                    <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="oprForm.controls['ownership'].invalid && 
                    oprForm.hasError('required', 'ownership') &&  oprForm.get('ownership')?.touched || (oprForm.controls['ownership'].dirty && 
                    oprForm.hasError('required', 'ownership'))"></i>

                    <input class="form-control is-invalid" type="text" formControlName="ownership" name="ownership"
                      id="ownership" placeholder="Owner/Source From">
                  </div>
                </div>
                <div class="col-6">
                  @if(!(oprForm.controls['userID2'].invalid &&
                  oprForm.hasError('required', 'userID2') &&
                  oprForm.get('userID2')?.touched ||
                  (oprForm.controls['userID2'].dirty &&
                  oprForm.hasError('required', 'userID2')))){
                  <small class="text-info">*
                    Issued By</small>
                  }@else {
                  <small class="text-danger" *ngIf="oprForm.controls['userID2'].invalid &&
                  oprForm.hasError('required', 'userID2') &&
                  oprForm.get('userID2')?.touched ||
                  (oprForm.controls['userID2'].dirty &&
                  oprForm.hasError('required', 'userID2')) || (oprForm.get('userID2')?.touched && issuedID === null)">*
                    Issued By is
                    required</small>
                  }

                  <div class="form-field d-flex align-items-center"
                    [class.error]="oprForm.controls['userID2'].invalid && oprForm.hasError('required', 'userID2')  && oprForm.get('userID2')?.touched
                    || (oprForm.controls['userID2'].dirty && oprForm.hasError('required', 'userID2')) || (oprForm.get('userID2')?.touched && issuedID === null) ">
                    <i class="fa-sharp-duotone fa-solid fa-caret-down"
                      *ngIf="!(oprForm.controls['userID2'].invalid &&
                      oprForm.hasError('required', 'userID2') &&
                      oprForm.get('userID2')?.touched ||
                      (oprForm.controls['userID2'].dirty &&
                      oprForm.hasError('required', 'userID2')) || (oprForm.get('userID2')?.touched && issuedID === null))"></i>
                    <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger"
                      *ngIf="oprForm.controls['userID2'].invalid && oprForm.hasError('required', 'userID2') &&  oprForm.get('userID2')?.touched
                      || (oprForm.controls['userID2'].dirty && oprForm.hasError('required', 'userID2')) || (oprForm.get('userID2')?.touched && issuedID === null)"></i>

                    <input type="text" class="form-control" id="navbarDropdown" formControlName="userID2" name="userID2"
                      [(ngModel)]="issuedByID" placeholder="Issued By" (keyup)="onAutoSuggestIssued()" role="textbox">
                  </div>

                  <div class="recent-searches" *ngIf="userProfiles.length > 0  && activeInput === 'issued'"
                    (blur)="activeInput = null">
                    <ul class="list-group list-group-flush py-3">
                      <li type="button" class="list-group-item list-group-item-action px-3 rounded-pill"
                        *ngFor="let up of userProfiles" (click)="selectIssued(up)">
                        {{ up.fullName }}</li>
                    </ul>
                  </div>
                </div>
                <div class="col-6">
                  @if(!(oprForm.controls['userID1'].invalid &&
                  oprForm.hasError('required', 'userID1') &&
                  oprForm.get('userID1')?.touched ||
                  (oprForm.controls['userID1'].dirty &&
                  oprForm.hasError('required', 'userID1')))){
                  <small class="text-info">*
                    Received By</small>
                  }@else {
                  <small class="text-danger"
                    *ngIf="oprForm.controls['userID1'].invalid &&
                    oprForm.hasError('required', 'userID1') &&
                    oprForm.get('userID1')?.touched ||
                    (oprForm.controls['userID1'].dirty &&
                    oprForm.hasError('required', 'userID1')) || (oprForm.get('userID1')?.touched && receivedID === null)">*
                    Received By is
                    required</small>
                  }

                  <div class="form-field d-flex align-items-center"
                    [class.error]="oprForm.controls['userID1'].invalid && oprForm.hasError('required', 'userID1')  && oprForm.get('userID1')?.touched
                    || (oprForm.controls['userID1'].dirty && oprForm.hasError('required', 'userID1') || (oprForm.get('userID1')?.touched && receivedID === null))">
                    <i class="fa-sharp-duotone fa-solid fa-caret-down"
                      *ngIf="!(oprForm.controls['userID1'].invalid &&
                      oprForm.hasError('required', 'userID1') &&
                      oprForm.get('userID1')?.touched ||
                      (oprForm.controls['userID1'].dirty &&
                      oprForm.hasError('required', 'userID1')) || (oprForm.get('userID1')?.touched && receivedID === null))"></i>
                    <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger"
                      *ngIf="oprForm.controls['userID1'].invalid && oprForm.hasError('required', 'userID1') &&  oprForm.get('userID1')?.touched
                      || (oprForm.controls['userID1'].dirty && oprForm.hasError('required', 'userID1')) || (oprForm.get('userID1')?.touched && receivedID === null)"></i>

                    <input type="text" class="form-control" id="navbarDropdown" formControlName="userID1" name="userID1"
                      [(ngModel)]="receivedByID" placeholder="Received By" (keyup)="onAutoSuggestReceived()"
                      role="textbox">

                  </div>

                  <div class="recent-searches" *ngIf="userProfiles.length > 0 && activeInput === 'received'"
                    (blur)="activeInput = null">
                    <ul class="list-group list-group-flush py-3">
                      <li type="button" class="list-group-item list-group-item-action px-3 rounded-pill"
                        *ngFor="let up of userProfiles" (click)="selectReceived(up)">
                        {{ up.fullName }}</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <div class="card-body py-0" *ngIf="isEditMode">
              <!-- <div class="card-body py-0"> -->
              <div class="row m-0">
                <div class="col py-0">

                  <div class="row py-3 bg-primary">
                    <div class="col">
                      <h5 class="ms-3 text-light">
                        List of Item
                      </h5>
                    </div>
                  </div>

                  <div class="row table-responsive scrollable p-0 m-0">
                    <div class="col p-0 m-0 table-body  ">
                      <table class="table table-striped table-hover">
                        <thead>
                          <tr>
                            <th class="sticky-header">#</th>
                            <th class="sticky-header">QTY</th>
                            <th class="sticky-header">UNIT</th>
                            <th class="sticky-header">DESCRIPTION</th>
                            <th class="sticky-header">DATE ACQUIRED</th>
                            <th class="sticky-header">PROPERTY NUMBER</th>
                            <th class="sticky-header">AMOUNT</th>
                            <th class="sticky-header text-center">ACTION</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngIf="oprItems.length<1">
                            <td colspan="9" class="text-danger text-center">*
                              Item list required! Add at least one!</td>
                          </tr>
                          <tr *ngFor="let p of oprItems; let i = index">
                            <td>{{i+1}}</td>
                            <td>1</td>
                            <td>{{p.unit}}</td>
                            <td>{{p.description}}</td>
                            <td>{{formatDate(p.date_Acquired)}}</td>
                            <td>{{p.propertyNo}}</td>
                            <td>{{ (p.amount || 0).toLocaleString('en-US', {
                              minimumFractionDigits: 2, maximumFractionDigits: 2
                              }) }}</td>
                            <td>
                              <form class="d-flex justify-content-end">
                                <a class="edit" type="button"><i class="fa-sharp-duotone fa-solid fa-pen-to-square"
                                    data-toggle="tooltip" title="Edit" (click)="onEditItem(p)"></i></a>
                                <a class="secondary" type="button" (click)="onCopyItem(p)"><i
                                    class="fa-sharp-duotone fa-solid fa-copy" data-toggle="tooltip"
                                    title="Copy"></i></a>
                                <a class="delete" type="button" (click)="onDeleteItem(p)"><i
                                    class="fa-sharp-duotone fa-solid fa-trash" data-toggle="tooltip"
                                    title="Delete"></i></a>
                                <a class="success" type="button" (click)="onViewItem(p)">
                                  <i class="fa-sharp-duotone fa-solid fa-eye" data-toggle="tooltip" title="View"></i>
                                </a>
                              </form>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <div class="card-footer py-2" *ngIf="isEditMode">
              <!-- <div class="card-footer py-2" > -->
              <a class="btn btn-success rounded-pill d-flex justify-content-center align-items-center " type="button"
                (click)="onAddPARItem()">
                <i class="fa-sharp-duotone fa-solid fa-plus"></i><span class="fs-6">NEW</span></a>
            </div>

          </div>

        </div>
        <div class="modal-footer">

          <button id="closeBut" type="button" class="btn btn-secondary rounded-pill me-2" data-bs-dismiss="modal"
            (click)="closeModal(AddEditModal)">Close</button>
          <button
            *ngIf="(isEditMode && canUpdate && opr.createdBy === userAccount.userID) || (!isEditMode && canCreate)"
            type="button" class="btn btn-primary rounded-pill" (click)="onSubmit()">{{ isEditMode ? 'Update' :
            'Save'
            }}</button>

        </div>
      </form>
    </div>
  </div>
</div>

<!-- OPR VIEW -->
<div #ViewModalForm class="modal fade" id="ViewModalForm">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content formGroup">
      <form class [formGroup]="optrForm">
        <div class="modal-header">

          <div class="d-flex flex-column">
            <h1 class="modal-title fs-5" id="staticBackdropLabel">
              {{(isOPTR? 'OPTR' : 'OPR') }}
            </h1>
            <span><em> Other Property {{(isOPTR? 'Transfer Report' :
                ' Receipt') }}
              </em></span>
          </div>

          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            (click)="closeModal(ViewModal)"></button>
        </div>

        <div class="modal-body p-0 m-0">
          <div class="card m-0">
            <!-- CARD HEADER -->
            <div class="card-header py-2">

              <div class="row">
                <div class="col">
                  <div class="simple-accordion">
                    <button class="accordion-header" (click)="toggleAccordion()" [attr.aria-expanded]="isOpen">
                      INFORMATION
                      <i class="fa-sharp-duotone fa-solid {{ isOpen? 'fa-caret-up' : 'fa-caret-down' }} "></i>
                    </button>
                    <div class="accordion-content" [class.show]="isOpen">

                      <div class="row d-flex flex-row">
                        <div class="col">
                          <small class="text-info">Source of Property</small>
                          <div class="form-field d-flex align-items-center">
                            <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="false"></i>
                            <input type="text" [value]="opr?.itemSource" class="form-control" placeholder="Item Source"
                              readonly>
                          </div>
                        </div>
                        <div class="col">
                          <small class="text-info">Owner/Source From</small>
                          <div class="form-field d-flex align-items-center">
                            <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="false"></i>
                            <input type="text" [value]="opr?.ownership" class="form-control" placeholder="Ownership"
                              readonly>
                          </div>
                        </div>
                      </div>

                      <div class="row d-flex flex-row">
                        <div class="col">
                          <small class="text-info">RECEIVED BY</small>
                          <div class="form-field d-flex align-items-center">
                            <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="false"></i>
                            <input type="text" [value]="opr?.received" class="form-control" placeholder="RECEIVED"
                              readonly>
                          </div>
                        </div>
                        <div class="col">
                          <small class="text-info">ISSUED BY</small>
                          <div class="form-field d-flex align-items-center">
                            <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="false"></i>
                            <input type="text" [value]="opr?.issued" class="form-control" placeholder="Issued" readonly>
                          </div>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>

            </div>
            <!-- END OF CARD HEADER -->
            <div class="card-body py-0">
              <!-- ITEM TABLE -->
              <div class="row m-0">
                <div class="col py-0">
                  
                  <p *ngIf="this.opr?.isReceivedActive || this.leave != null" class="text-center">
                    In absence of Mr./Ms. <span class="text-danger fw-bold"> {{opr.received}} </span>,
                    <span class="text-primary fw-bold px-1">
                      {{leave.careOfUser}} </span>
                    will take over the properties below.
                  </p>
                  
                  <div class="row py-3 bg-primary">

                    <div class="col-3 d-flex align-items-center">
                      <h5 class="ms-3 text-light">List of Items</h5>
                    </div>

                    <div class="col d-flex justify-content-end align-items-center h-100">
                      <div class="searchbar">
                        <input class="search_input" type="text" name="searchPARItemKey"
                          formControlName="searchPARItemKey" (keyup)="searchPARItem()" placeholder="Search...">
                        <a type="button" class="search_icon" (click)="searchPARItem()">
                          <i class="fas fa-search"></i>
                        </a>
                      </div>
                    </div>

                  </div>
                  <!-- table-responsive -->
                  <div class="row table-responsive scrollable p-0 m-0">
                    <div class="col p-0 m-0 table-body ">
                      <table class="table table-striped table-hover">
                        <thead>
                          <tr>
                            <th class="sticky-header">
                              <!-- "Select All" Checkbox in the Header -->
                              @if(isOPTR && noOfParItems > 1){
                              <div class="form-check form-switch form-check-inline">
                                <input class="form-check-input" type="checkbox" id="selectAll"
                                  (change)="toggleAllSelection($event)" />
                                <label class="form-check-label" for="selectAll">OPTR</label>
                              </div>
                              }@else{
                              PTR
                              }
                            </th>
                            <th class="sticky-header">#</th>
                            <th class="sticky-header">QTY</th>
                            <th class="sticky-header">UNIT</th>
                            <th class="sticky-header">DESCRIPTION</th>
                            <th class="sticky-header">DATE ACQUIRED</th>
                            <th class="sticky-header">PROPERTY NUMBER</th>
                            <th class="sticky-header">AMOUNT</th>
                          </tr>
                        </thead>
                        <tbody>
                          <ng-container *ngFor="let p of oprItems; let i = index">
                            <!-- *ngIf="(!isRepar) || (isRepar && !p.reparFlag)" -->
                            <tr [class.border-warning]="item?.qrCode == p.qrCode">
                              <td>
                                <div class="form-check form-switch form-check-inline">
                                  <input class="form-check-input" type="checkbox" [checked]="p.optrFlag"
                                    (change)="toggleSelection(p, $event)" [disabled]="!isOPTR" />
                                </div>
                              </td>
                              <td>{{ i + 1 }}</td>
                              <td>1</td>
                              <td>{{ p.unit }}</td>
                              <td>{{ p.description }}</td>
                              <td>{{ formatDate(p.date_Acquired) }}</td>
                              <td>{{ p.propertyNo }}</td>
                              <td>{{ (p.amount || 0).toLocaleString('en-US', {
                                minimumFractionDigits: 2, maximumFractionDigits:
                                2 }) }}</td>
                              <td>
                                <a class="success" type="button" (click)="onViewItem(p)">
                                  <i class="fa-sharp-duotone fa-solid fa-eye" data-toggle="tooltip" title="View"></i>
                                </a>

                              </td>
                            </tr>
                          </ng-container>
                        </tbody>
                      </table>
                    </div>
                  </div>

                </div>
              </div>
              <!-- END OF ITEM TABLE -->
            </div>
            <!-- END OF CARD BODY -->
            <div class="card-footer">

              <div class="row d-flex flex-row" *ngIf="noOfParItems > 0 && isOPTR">
                <div class="col-12 col-sm-12 col-md-6 col-lg-6">

                  <small class="text-info">*
                    Issued By</small>

                  <div class="form-field d-flex align-items-center">

                    <select class="form-select" formControlName="userID2" name="userID2" id="userID2" readonly>
                      <option [value]="opr.receivedBy ">{{ opr.received
                        }}</option>
                    </select>
                  </div>

                  <small class="text-info">*
                    Approve By</small>

                  <div class="form-field d-flex align-items-center"
                    [class.error]="optrForm.controls['userID3'].invalid && optrForm.hasError('required', 'userID3')  && optrForm.get('userID3')?.touched ||
                    (optrForm.controls['userID3'].dirty && optrForm.hasError('required', 'userID3')) || (optrForm.get('userID3')?.touched && approvedID === null)">
                    <i class="fa-sharp-duotone fa-solid fa-caret-down"
                      *ngIf="!(optrForm.controls['userID3'].invalid && optrForm.hasError('required', 'userID3') &&
                      optrForm.get('userID3')?.touched || (optrForm.controls['userID3'].dirty &&
                      optrForm.hasError('required', 'userID3')) || (optrForm.get('userID3')?.touched && approvedID === null))"></i>
                    <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger"
                      *ngIf="optrForm.controls['userID3'].invalid && optrForm.hasError('required', 'userID3') &&  optrForm.get('userID3')?.touched ||
                      (optrForm.controls['userID3'].dirty && optrForm.hasError('required', 'userID3')) || (optrForm.get('userID3')?.touched && approvedID === null)"></i>

                    <input type="text" class="form-control" id="navbarDropdown" formControlName="userID3" name="userID3"
                      [(ngModel)]="approvedByID" placeholder="Approve By" (keyup)="onAutoSuggestApproved()"
                      role="textbox">

                  </div>

                  <div class="recent-searches" *ngIf="userProfiles.length > 0 && activeInput === 'approved'"
                    (blur)="activeInput = null">
                    <ul class="list-group list-group-flush py-3">
                      <li type="button" class="list-group-item list-group-item-action px-3 rounded-pill"
                        *ngFor="let up of userProfiles" (click)="selectApproved(up)">
                        {{ up.fullName }}</li>
                    </ul>
                  </div>

                  <small class="text-info">*
                    Received By</small>

                  <div class="form-field d-flex align-items-center"
                    [class.error]="optrForm.controls['userID1'].invalid && optrForm.hasError('required', 'userID1')  && optrForm.get('userID1')?.touched ||
                    (optrForm.controls['userID1'].dirty && optrForm.hasError('required', 'userID1')) || (optrForm.get('userID1')?.touched && receivedID === null)">
                    <i class="fa-sharp-duotone fa-solid fa-caret-down"
                      *ngIf="!(optrForm.controls['userID1'].invalid && optrForm.hasError('required', 'userID1') &&
                      optrForm.get('userID1')?.touched || (optrForm.controls['userID1'].dirty &&
                      optrForm.hasError('required', 'userID1')) || (optrForm.get('userID1')?.touched && receivedID === null))"></i>
                    <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger"
                      *ngIf="optrForm.controls['userID1'].invalid && optrForm.hasError('required', 'userID1') &&  optrForm.get('userID1')?.touched ||
                      (optrForm.controls['userID1'].dirty && optrForm.hasError('required', 'userID1')) || (optrForm.get('userID1')?.touched && receivedID === null)"></i>

                    <input type="text" class="form-control" id="navbarDropdown" formControlName="userID1" name="userID1"
                      [(ngModel)]="receivedByID" placeholder="Received By" (keyup)="onAutoSuggestReceived()"
                      role="textbox">
                  </div>

                  <div class="recent-searches" *ngIf="userProfiles.length > 0 && activeInput === 'received'"
                    (blur)="activeInput = null">
                    <ul class="list-group list-group-flush py-3">
                      <li type="button" class="list-group-item list-group-item-action px-3 rounded-pill"
                        *ngFor="let up of userProfiles" (click)="selectReceived(up)">
                        {{ up.fullName }}</li>
                    </ul>
                  </div>

                </div>

                <div class="col-12 col-sm-12 col-md-6 col-lg-6">

                  <!-- Transfer type -->

                  @if(!(optrForm.controls['type'].invalid &&
                  optrForm.hasError('required', 'type') &&
                  optrForm.get('type')?.touched ||
                  (optrForm.controls['type'].dirty &&
                  optrForm.hasError('required', 'type')))){
                  <small class="text-info">* Transfer Type</small>
                  }@else{
                  <small class="text-danger"
                    *ngIf="optrForm.controls['type'].invalid &&
                    optrForm.hasError('required', 'type') &&
                    optrForm.get('type')?.touched ||
                    (optrForm.controls['type'].dirty &&
                    optrForm.hasError('required', 'type')) ||
                    (isCustomType && ((optrForm.controls['type'].invalid &&
                  optrForm.hasError('required', 'type') &&
                  optrForm.get('type')?.touched) || (optrForm.controls['others'].dirty && optrForm.hasError('required', 'others'))))">*
                    Transfer Type is required</small>
                  }

                  <!-- Other Transfer type -->

                  <small class="text-danger"
                    *ngIf="isCustomType && optrForm.controls['others'].invalid && optrForm.get('others')?.touched">
                    Specify 'Others' is required.
                  </small>

                  <div class="form-field d-flex align-items-center" [class.error]="optrForm.controls['type'].invalid && optrForm.hasError('required', 'type')  && optrForm.get('type')?.touched ||
                    (optrForm.controls['type'].dirty && optrForm.hasError('required', 'type')) ||
                    (isCustomType && optrForm.controls['others'].invalid && optrForm.hasError('required', 'others')  && optrForm.get('others')?.touched ||
                  (optrForm.controls['others'].dirty && optrForm.hasError('required', 'others'))) ||
                    (isCustomType && optrForm.get('others')?.invalid && optrForm.get('others')?.touched)">

                    <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="(optrForm.controls['others'].invalid && optrForm.hasError('required', 'others')  && optrForm.get('others')?.touched ||
                      (optrForm.controls['others'].dirty && optrForm.hasError('required', 'others'))) ||
                        (isCustomType && optrForm.get('others')?.invalid && optrForm.get('others')?.touched)">
                    </i>

                    <select formControlName="type" name="type" id="type" class="form-select"
                      (change)="onTypeChange($event)">
                      <option value>Transfer Type</option>
                      <option *ngFor="let option of transferOptions" [value]="option">{{option}}</option>
                      <option value="Others">Others</option>
                    </select>

                    <input *ngIf="isCustomType" type="text" id="others" #othersInput value="N/A"
                      formControlName="others" placeholder="Specify" class="form-control">
                  </div>

                  <!-- Reason -->

                  @if(!(optrForm.controls['reason'].invalid &&
                  optrForm.hasError('required', 'reason') &&
                  optrForm.get('reason')?.touched ||
                  (optrForm.controls['reason'].dirty &&
                  optrForm.hasError('required', 'reason')))){
                  <small class="text-info">* Reason for Transfer</small>
                  }@else{
                  <small class="text-danger"
                    *ngIf="optrForm.controls['reason'].invalid && optrForm.hasError('required', 'reason') &&
                    optrForm.get('reason')?.touched || (optrForm.controls['reason'].dirty && optrForm.hasError('required', 'reason'))">*
                    Reason for Transfer is required</small>
                  }
                  <div class="form-field d-flex align-items-center" [class.error]="optrForm.controls['reason'].invalid &&
                  optrForm.hasError('required', 'reason') && optrForm.get('reason')?.touched ||
                  (optrForm.controls['reason'].dirty && optrForm.hasError('required', 'reason'))">

                    <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="optrForm.controls['reason'].invalid &&
                    optrForm.hasError('required', 'reason') && optrForm.get('reason')?.touched ||
                    (optrForm.controls['reason'].dirty && optrForm.hasError('required', 'reason'))"></i>

                    <textarea formControlName="reason" name="reason" id="reason" placeholder="Reason/s for Transfer"
                      rows="4" cols="50"></textarea>
                  </div>

                </div>

              </div>

              <div class="row" *ngIf="noOfParItems < 1 && isOPTR">
                <div class="col">
                  <h6 class="p-3 text-center text-danger">ITEM(s) FULLY
                    TRASFERED.</h6>
                </div>
              </div>
            </div>
            <!-- END OF CARD FOOTER -->
          </div>
          <!-- END OF CARD -->
        </div><!-- END OF MODAL BODY -->

        <div class="modal-footer">
          <button type="button" class="btn btn-warning rounded-pill" *ngIf="!opr?.postFlag || false"
            (click)="onEditOPR(opr)">Edit</button>
          <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal"
            (click)="closeModal(ViewModal)">Close</button>
          <button type="button" class="btn btn-primary rounded-pill" *ngIf="isOPTR && noOfParItems > 0"
            (click)="onSubmitOPTR()">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ITEM ADD/EDIT -->
<div #ItemModalForm class="modal fade" id="ItemModalForm">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form class [formGroup]="itemForm" ng-reflect-form="[object Object]" class="ng-untouched ng-pristine ng-invalid">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">{{
            isEditItemMode ?
            'Edit' : 'New' }} Item</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            (click)="closeModal(ItemModal)"></button>
        </div>
        <div class="modal-body item-body scrollable">
          <div class="formGroup row">
            <div class="col-lg ">

              @if(itemForm.controls['iid'].invalid &&
              itemForm.hasError('required', 'iid') &&
              itemForm.get('iid')?.touched ||
              (itemForm.controls['iid'].dirty && itemForm.hasError('required',
              'iid'))) {
              <small class="text-danger">* Item is required</small>
              }@else if (iid == null && itemForm.get('iid')?.touched) {
              <small class="text-danger">* Item not Found</small>
              }@else{
              <small class="text-info">* Item</small>
              }

              <div class="form-field d-flex align-items-center" [class.error]="((itemForm.controls['iid'].invalid && itemForm.hasError('required', 'iid') && iid==null) &&  itemForm.get('iid')?.touched)  ||
             (itemForm.controls['iid'].dirty && itemForm.hasError('required', 'iid'))">
                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="((itemForm.controls['iid'].invalid && itemForm.hasError('required', 'iid') || iid==null) && itemForm.get('iid')?.touched) ||
             (itemForm.controls['iid'].dirty && itemForm.hasError('required', 'iid'))"></i>

                <input type="text" class="form-control" id="navbarDropdown" formControlName="iid" name="iid"
                  [(ngModel)]="IIDKey" placeholder="Item" (keydown.enter)="onAutoSuggestItem()"
                  (keyup)="onAutoSuggestItem()" role="textbox">

              </div>

              <div class="recent-searches" *ngIf="items.length > 0 && IIDKey!">
                <ul class="list-group list-group-flush py-3">
                  <li type="button" class="list-group-item list-group-item-action px-3 rounded-pill"
                    *ngFor="let i of items" (click)="selectItem(i)">
                    {{ i.description }}</li>
                </ul>
              </div>

              <!-- BRAND -->
              @if(!(itemForm.controls['brand'].invalid &&
              itemForm.hasError('required', 'brand') &&
              itemForm.get('brand')?.touched ||
              (itemForm.controls['brand'].dirty &&
              itemForm.hasError('required', 'brand')))){
              <small class="text-info">*
                Brand</small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['brand'].invalid && itemForm.hasError('required', 'brand') && itemForm.get('brand')?.touched ||
                   (itemForm.controls['brand'].dirty && itemForm.hasError('required', 'brand'))">*
                Brand is required</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['brand'].invalid && itemForm.hasError('required', 'brand') &&  itemForm.get('brand')?.touched ||
               (itemForm.controls['brand'].dirty && itemForm.hasError('required', 'brand'))">

                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['brand'].invalid && itemForm.hasError('required', 'brand') &&  itemForm.get('brand')?.touched ||
                 (itemForm.controls['brand'].dirty && itemForm.hasError('required', 'brand'))"></i>

                <input type="text" formControlName="brand" [(ngModel)]="brand" name="brand" id="brand"
                  (keyup)="updateDescription()" placeholder="Brand">
              </div>

              <!-- MODEL -->
              @if(!(itemForm.controls['model'].invalid &&
              itemForm.hasError('required', 'model') &&
              itemForm.get('model')?.touched ||
              (itemForm.controls['model'].dirty &&
              itemForm.hasError('required', 'model')))){
              <small class="text-info">*
                Model</small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['model'].invalid && itemForm.hasError('required', 'model') && itemForm.get('model')?.touched ||
                   (itemForm.controls['model'].dirty && itemForm.hasError('required', 'model'))">*
                Model is required</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['model'].invalid && itemForm.hasError('required', 'model') &&  itemForm.get('model')?.touched ||
               (itemForm.controls['model'].dirty && itemForm.hasError('required', 'model'))">

                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['model'].invalid && itemForm.hasError('required', 'model') &&  itemForm.get('model')?.touched ||
                 (itemForm.controls['model'].dirty && itemForm.hasError('required', 'model'))"></i>

                <input type="text" formControlName="model" [(ngModel)]="model" name="model" id="model"
                  (keyup)="updateDescription()" placeholder="Model">
              </div>

              <!-- DESCRIPTION -->
              @if(!(itemForm.controls['description'].invalid &&
              itemForm.hasError('required', 'description') &&
              itemForm.get('description')?.touched ||
              (itemForm.controls['description'].dirty &&
              itemForm.hasError('required', 'description')))){
              <small class="text-info">*
                Description</small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['description'].invalid && itemForm.hasError('required', 'description') && itemForm.get('description')?.touched ||
                    (itemForm.controls['description'].dirty && itemForm.hasError('required', 'description'))">*
                Description is required</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['description'].invalid && itemForm.hasError('required', 'description') &&  itemForm.get('description')?.touched ||
                (itemForm.controls['description'].dirty && itemForm.hasError('required', 'description'))">

                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['description'].invalid && itemForm.hasError('required', 'description') &&  itemForm.get('description')?.touched ||
                  (itemForm.controls['description'].dirty && itemForm.hasError('required', 'description'))"></i>

                <textarea type="text" formControlName="description" [ngModel]="parItemKey" name="description"
                  id="description" placeholder="Description"></textarea>
              </div>

              <!-- SERIAL NO. -->
              @if(!(itemForm.controls['serialNo'].invalid &&
              itemForm.hasError('required', 'serialNo') &&
              itemForm.get('serialNo')?.touched ||
              (itemForm.controls['serialNo'].dirty &&
              itemForm.hasError('required', 'serialNo')))){
              <small class="text-info">*
                Serial No. <span class="text-danger">(User Property no. if no Serial no.) </span></small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['serialNo'].invalid && itemForm.hasError('required', 'serialNo') && itemForm.get('serialNo')?.touched ||
                   (itemForm.controls['serialNo'].dirty && itemForm.hasError('required', 'serialNo'))">*
                Serial No. is required (User Property no. if no Serial no.)</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['serialNo'].invalid && itemForm.hasError('required', 'serialNo') &&  itemForm.get('serialNo')?.touched ||
               (itemForm.controls['serialNo'].dirty && itemForm.hasError('required', 'serialNo'))">

                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['serialNo'].invalid && itemForm.hasError('required', 'serialNo') &&  itemForm.get('serialNo')?.touched ||
                 (itemForm.controls['serialNo'].dirty && itemForm.hasError('required', 'serialNo'))"></i>

                <input type="text" formControlName="serialNo" name="serialNo" id="serialNo" placeholder="Serial No.">
              </div>

              <!-- QR Code -->
              @if(!(itemForm.controls['qrCode'].invalid &&
              itemForm.hasError('required', 'qrCode') &&
              itemForm.get('qrCode')?.touched ||
              (itemForm.controls['qrCode'].dirty &&
              itemForm.hasError('required', 'qrCode')))){
              <small class="text-info">*
                QR Code</small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['qrCode'].invalid && itemForm.hasError('required', 'qrCode') && itemForm.get('qrCode')?.touched ||
                (itemForm.controls['qrCode'].dirty && itemForm.hasError('required', 'qrCode'))">*
                QR Code is required</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['qrCode'].invalid && itemForm.hasError('required', 'qrCode') &&  itemForm.get('qrCode')?.touched ||
                (itemForm.controls['qrCode'].dirty && itemForm.hasError('required', 'qrCode'))">

                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['qrCode'].invalid && itemForm.hasError('required', 'qrCode') &&  itemForm.get('qrCode')?.touched ||
                  (itemForm.controls['qrCode'].dirty && itemForm.hasError('required', 'qrCode'))"></i>

                <input type="text" formControlName="qrCode" name="qrCode" id="qrCode" placeholder="QR Code">

                <button type="button" class="bg-primary border-0 rounded-pill py-1 px-2 me-3"
                  (click)="handle(scannerAction, scannerAction.isStart ? 'stop' : 'start', 'get')"
                  [class.btn-warning]="scannerAction?.isStart" [disabled]="scannerAction?.isLoading || false">
                  <i class="fa-solid fa-qrcode text-white"></i></button>

              </div>

              <!-- PROPERTY NO. -->
              @if(!(itemForm.controls['propertyNo'].invalid &&
              itemForm.hasError('required', 'propertyNo') &&
              itemForm.get('propertyNo')?.touched ||
              (itemForm.controls['propertyNo'].dirty &&
              itemForm.hasError('required', 'propertyNo')))){
              <small class="text-info">*
                Property No.</small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['propertyNo'].invalid && itemForm.hasError('required', 'propertyNo') && itemForm.get('propertyNo')?.touched ||
                (itemForm.controls['propertyNo'].dirty && itemForm.hasError('required', 'propertyNo'))">*
                Property No. is required</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['propertyNo'].invalid && itemForm.hasError('required', 'propertyNo') &&  itemForm.get('propertyNo')?.touched ||
                (itemForm.controls['propertyNo'].dirty && itemForm.hasError('required', 'propertyNo'))">

                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['propertyNo'].invalid && itemForm.hasError('required', 'propertyNo') &&  itemForm.get('propertyNo')?.touched ||
                  (itemForm.controls['propertyNo'].dirty && itemForm.hasError('required', 'propertyNo'))"></i>

                <input type="text" formControlName="propertyNo" name="propertyNo" id="propertyNo"
                  placeholder="Property No.">
              </div>

              <!-- UNIT -->
              @if(!(itemForm.controls['unit'].invalid &&
              itemForm.hasError('required', 'unit') &&
              itemForm.get('unit')?.touched ||
              (itemForm.controls['unit'].dirty &&
              itemForm.hasError('required', 'unit')))){
              <small class="text-info">*
                Unit</small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['unit'].invalid && itemForm.hasError('required', 'unit') && itemForm.get('unit')?.touched ||
                (itemForm.controls['unit'].dirty && itemForm.hasError('required', 'unit'))">*
                Unit is required</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['unit'].invalid && itemForm.hasError('required', 'unit')  && itemForm.get('unit')?.touched || (itemForm.controls['unit'].dirty &&
                itemForm.hasError('required', 'unit'))">
                <i class="fa-sharp-duotone fa-solid fa-caret-down" *ngIf="!(itemForm.controls['unit'].invalid &&
                  itemForm.hasError('required', 'unit') &&
                itemForm.get('unit')?.touched ||
                (itemForm.controls['unit'].dirty &&
                itemForm.hasError('required', 'unit')))"></i>
                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['unit'].invalid && itemForm.hasError('required', 'unit') &&  itemForm.get('unit')?.touched ||
                (itemForm.controls['unit'].dirty && itemForm.hasError('required', 'unit'))"></i>

                <select class="form-select" formControlName="unit" name="unit" id="unit">
                  <option value>Select Unit</option>
                  <option value="pcs">pcs</option>
                  <option value="ml">ml</option>
                  <option value="kl">kl</option>
                </select>
              </div>

              <!-- AMOUNT -->
              @if(!(itemForm.controls['amount'].invalid &&
              itemForm.hasError('required', 'amount') &&
              itemForm.get('amount')?.touched ||
              (itemForm.controls['amount'].dirty &&
              itemForm.hasError('required', 'amount')))){
              <small class="text-info">*
                Cost/Amount</small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['amount'].invalid && itemForm.hasError('required', 'amount') && itemForm.get('amount')?.touched ||
                (itemForm.controls['amount'].dirty && itemForm.hasError('required', 'amount'))">*
                Cost/Amount is required</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['amount'].invalid && itemForm.hasError('required', 'amount') &&  itemForm.get('amount')?.touched ||
                (itemForm.controls['amount'].dirty && itemForm.hasError('required', 'amount'))">

                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['amount'].invalid && itemForm.hasError('required', 'amount') &&  itemForm.get('amount')?.touched ||
                  (itemForm.controls['amount'].dirty && itemForm.hasError('required', 'amount'))"></i>

                <input type="text" formControlName="amount" name="amount" id="amount" placeholder="Cost/Amount">
              </div>

              <!-- DATE ACQUIRED -->
              @if(!(itemForm.controls['date_Acquired'].invalid &&
              itemForm.hasError('required', 'date_Acquired') &&
              itemForm.get('date_Acquired')?.touched ||
              (itemForm.controls['date_Acquired'].dirty &&
              itemForm.hasError('required', 'date_Acquired')))){
              <small class="text-info">*
                Date Acquired</small>
              }@else {
              <small class="text-danger" *ngIf="itemForm.controls['date_Acquired'].invalid && itemForm.hasError('required', 'date_Acquired') && itemForm.get('date_Acquired')?.touched ||
                (itemForm.controls['date_Acquired'].dirty && itemForm.hasError('required', 'date_Acquired'))">*
                Date Acquired is required</small>
              }
              <div class="form-field d-flex align-items-center" [class.error]="itemForm.controls['date_Acquired'].invalid && itemForm.hasError('required', 'date_Acquired') &&  itemForm.get('date_Acquired')?.touched ||
                (itemForm.controls['date_Acquired'].dirty && itemForm.hasError('required', 'date_Acquired'))">

                <i class="fa-sharp-duotone fa-solid fa-circle-exclamation text-danger" *ngIf="itemForm.controls['date_Acquired'].invalid && itemForm.hasError('required', 'date_Acquired') &&  itemForm.get('date_Acquired')?.touched ||
                  (itemForm.controls['date_Acquired'].dirty && itemForm.hasError('required', 'date_Acquired'))"></i>

                <input type="date" formControlName="date_Acquired" name="date_Acquired" id="date_Acquired"
                  placeholder="Date Acquired is required">
              </div>

            </div>
          </div>

        </div>
        <div class="modal-footer">
          <button id="closeBut" type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal"
            (click)="closeModal(ItemModal)">Close</button>
          <button type="button" class="btn btn-primary rounded-pill" (click)="onAddItem()">{{ isEditItemMode ? 'Update'
            :
            'Add' }}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ITEM VIEW MODAL -->
<div #ViewItemModalForm class="modal fade" id="ViewItemModalForm" tabindex="-1" aria-labelledby="ItemModalFormLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="ItemModalFormLabel">Item
          Details</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          (click)="closeModal(ViewItemModal)"></button>
      </div>
      <div class="modal-body item-body scrollable">
        <!-- ITEM DETAILS -->
        <div class="row">
          <div class="col-lg-12">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <td class="fw-bold">Item:</td>
                  <td>{{ itemName || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Brand:</td>
                  <td>{{ item?.brand || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Model:</td>
                  <td>{{ item?.model || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Description:</td>
                  <td>{{ item?.description || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Serial No.:</td>
                  <td>{{ item?.serialNo || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Property No.:</td>
                  <td>{{ item?.propertyNo || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">QR Code:</td>
                  <td>{{ item?.qrCode || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Unit:</td>
                  <td>{{ item?.unit || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Cost/Amount:</td>
                  <td>{{ (item?.amount || 0).toLocaleString('en-US', {
                    minimumFractionDigits: 2, maximumFractionDigits: 2 })
                    }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Date Acquired:</td>
                  <td>{{ (item?.date_Acquired | date:'shortDate') || 'N/A'
                    }}</td>
                </tr>
                <tr *ngIf="item?.optrFlag">
                  <td class="fw-bold">OPTR No.:</td>
                  <td>{{ 'OPTR-000'+ (item?.optrNo) || 'N/A' }}</td>
                </tr>
                <tr *ngIf="item?.optrFlag">
                  <td class="fw-bold">Issued to:</td>
                  <td>{{ optr?.received! || 'N/A' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning rounded-pill" *ngIf="!opr?.postFlag && isEditMode"
          (click)="onEditItem(item!)">Edit</button>
        <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal"
          (click)="closeModal(ViewItemModal)">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- QR CODE SCANNER -->
<div #QRScannerForm class="modal fade" id="QRScannerForm">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5">Scan QR Item</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          (click)="onCloseQRScanning(scannerAction)"></button>
      </div>
      <div class="modal-body item-body scrollable">
        <!-- ngx-scanner-qrcode -->
        <div class="qr-overlay">
          <div class="qr-overlay-line"></div>
        </div>

        <ngx-scanner-qrcode #scannerAction="scanner" [config]="config" (event)="onEvent($event, scannerAction)">
        </ngx-scanner-qrcode>

        <div *ngIf="this.purpose != 'get'" class="formGroup mt-2">
          <label class="fst-italic text-primary" for="qrCodeField">If the QR code is unclear and cannot be detected by
            the camera, please use the input field provided below to enter the information manually.</label>
          <input class="form-control rounded-pill mt-3" id="qrCodeField" type="text" placeholder="Enter QR Here.."
            aria-label="Search" [(ngModel)]="qrCode" (keydown.enter)="onEnter()" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal"
          (click)="onCloseQRScanning(scannerAction)">Close</button>
        <button type="button" class="btn btn-primary rounded-pill" *ngIf="scannerAction?.isPause"
          (click)="resumeScanning(scannerAction)">Scan Again</button>
      </div>
    </div>
  </div>
</div>